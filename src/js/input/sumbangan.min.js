var default_biaowen_list=new Array,bank_arr=new Array;function reinit_metode_pembayaran(){var metode_pembayaran;"Transfer"===$("#metode_pembayaran").val()?($(".accordion .nav_icon1").css("background","url("+src_base_url+"img/arrow-up2.png) center / contain no-repeat"),$(".search_box2").slideDown(),$("#id_bank, #bank, #rek_pengirim").prop("disabled",!1)):($(".accordion .nav_icon1").css("background","url("+src_base_url+"img/arrow-down2.png) center / contain no-repeat"),$(".search_box2").slideUp(),$("#id_bank, #bank, #rek_pengirim").prop("disabled",!0))}function tambah_biaowen(){var biaowen=$("#nama_biaowen").val().trim();if(""!==biaowen){var tr_input="<tr>";tr_input+="<td>"+($("tbody").children().length+1)+"</td>",tr_input+="<td class='centered'><input type='text' class='hidden' name='biaowen[]' value='0|"+biaowen+"'/>",tr_input+="<input type='checkbox'/></td>",tr_input+="<td><div class='name_box2'><input type='text' readonly value='"+biaowen+"'></div></td>",tr_input+="<td class='centered'><a href='#' class='hapus_biaowen'>Hapus</a></td>",tr_input+="</tr>",$("tbody").append(tr_input),$("#nama_biaowen").val("").focus()}}function hapus_biaowen(element){for(var index=element.parent().parent().index(),tr_arr=$("tbody").children(),length=tr_arr.length,i=index+1;i<length;i++)tr_arr.eq(i).children().first().first().html(i);tr_arr.eq(index).remove()}$(document).ready((function(){$.when(prepare_donatur_list("input/sumbangan")).done((function(){console.log("done"),reinit_metode_pembayaran();var filter=$("#kode_donatur").val().toLowerCase(),index=$("#index").val(),id_paket_sumbangan=$("#id_paket_sumbangan").val();""!==filter&&""===index&&$.each($donatur_arr,(function(i,donatur){var kode_donatur;if(donatur.kode_donatur.toLowerCase()===filter){$("#index").prop("defaultValue",i);var bank_list=donatur.detail_paket.split("#").find(paket=>paket.split("|")[0]==id_paket_sumbangan).split("|")[3];if("-"!==bank_list)for(var length=(bank_list=bank_list.split(";")).length,i=0;i<length;i++){var id_bank=bank_list[i].split("~")[0],an=bank_list[i].split("~")[1],no_rek=bank_list[i].split("~")[2];bank_arr[i]={id_bank:id_bank,an:an,no_rek:no_rek}}}}))})),$("input[name='biaowen[]']").each((function(i){default_biaowen_list[i]=this.value})),$("#kode_donatur").on("change",(function(){var filter=$("#kode_donatur").val().toLowerCase();$("#index").val(""),$("#kode_donatur").val(""),$("#nama_donatur").val(""),$("#id_paket_sumbangan").val(""),$("#nama_paket").val(""),$("#paket_list").empty(),$("#sisa_nilai_paket").val(""),$("#sisa_nilai_paket1").val(""),$("#metode_pembayaran").val("Tunai"),reinit_metode_pembayaran(),$("#id_bank, #bank").val(""),bank_arr=[],$("tbody").empty(),""!==filter&&$.each($donatur_arr,(function(i,donatur){var kode_donatur=donatur.kode_donatur,nama_donatur=donatur.nama_id;if(kode_donatur.toLowerCase()===filter||nama_donatur.toLowerCase()===filter)return $("#index").val(i),$("#kode_donatur").val(kode_donatur),$("#nama_donatur").val(nama_donatur),$("#nama_penyumbang").val(nama_donatur),!1}))})),$("#nama_paket").on("focus keyup",(function(){var index=$("#index").val();if(!is_nan(index))for(var filter=$(this).val().toLowerCase(),counter=0,paket_list=$("#paket_list").empty(),paket_arr=$donatur_arr[index].detail_paket.split("#"),length=paket_arr.length,i=0;i<length;i++){var nama_paket=paket_arr[i].split("|")[0]+"#"+paket_arr[i].split("|")[1];if(nama_paket.toLowerCase().includes(filter)&&(paket_list.append("<option value='"+nama_paket+"'/>"),10==++counter))break}})),$("#nama_paket").on("change",(function(){var index=$("#index").val();$("#id_paket_sumbangan").val(""),$("#sisa_nilai_paket").val(""),$("#sisa_nilai_paket1").val(""),$("#id_bank, #bank").val(""),bank_arr=[];var tbody=$("table.tb_input tbody").empty();if(!is_nan(index)){var nama_paket=$(this).val().split("#");if(2!==nama_paket.length)return;var detail_paket=$donatur_arr[index].detail_paket.split("#").find(paket=>paket.split("|")[0]===nama_paket[0].trim()&&paket.split("|")[1]===nama_paket[1].trim());if(void 0!==detail_paket){var jumlah_donasi=convert_currency_tonumber($("#jumlah_donasi").val()),id_paket_sumbangan=detail_paket.split("|")[0],sisa_nilai_paket=detail_paket.split("|")[2],bank_list=detail_paket.split("|")[3],biaowen_list=detail_paket.split("|")[4];if(""!==$("#id_sumbangan").prop("defaultValue")&&$("#id_paket_sumbangan").prop("defaultValue")==id_paket_sumbangan&&(sisa_nilai_paket=parseFloat($("#sisa_nilai_paket1").prop("defaultValue"))),$("#id_paket_sumbangan").val(id_paket_sumbangan),$("#sisa_nilai_paket1").val(sisa_nilai_paket),"-"===sisa_nilai_paket?$("#sisa_nilai_paket").val("∞"):(is_nan(jumlah_donasi)||(sisa_nilai_paket-=jumlah_donasi),$("#sisa_nilai_paket").val(convert_number_tocurrency(sisa_nilai_paket))),"-"!==bank_list)for(var length=(bank_list=bank_list.split(";")).length,i=0;i<length;i++){var id_bank=bank_list[i].split("~")[0],an=bank_list[i].split("~")[1],no_rek=bank_list[i].split("~")[2];bank_arr[i]={id_bank:id_bank,an:an,no_rek:no_rek}}void 0!==biaowen_list&&(biaowen_list=biaowen_list.split(";")).forEach((biaowen,i)=>{var tr_input="<tr>";tr_input+="<td>"+(i+1)+"</td>",tr_input+="<td class='centered'><input type='text' class='hidden' name='biaowen[]' value='0|"+biaowen+"'/>",tr_input+="<input type='checkbox'/></td>",tr_input+="<td><div class='name_box2'><input type='text' readonly value='"+biaowen+"' /></div></td>",tr_input+="<td class='centered'><a href='#' class='hapus_biaowen'>Hapus</a></td>",tr_input+="</tr>",tbody.append(tr_input)})}}})),$("#jumlah_donasi").on("keyup changed",(function(){var jumlah_donasi=convert_currency_tonumber($(this).val()),sisa_nilai_paket1=$("#sisa_nilai_paket1").val();if(!is_nan(sisa_nilai_paket1))if(is_nan(jumlah_donasi))$("#sisa_nilai_paket").val(convert_number_tocurrency(sisa_nilai_paket1));else{var sisa=sisa_nilai_paket1-jumlah_donasi;$("#sisa_nilai_paket").val(convert_number_tocurrency(sisa))}$(this).val(convert_number_tocurrency(jumlah_donasi))})),$("#metode_pembayaran").on("change",(function(){reinit_metode_pembayaran()})),$("#bank").on("focus keyup",(function(){for(var filter=$(this).val().toLowerCase(),counter=0,bank_list=$("#bank_list").empty(),length=bank_arr.length,i=0;i<length;i++){var an=bank_arr[i].an,no_rek=bank_arr[i].no_rek;if((an.toLowerCase().includes(filter)||no_rek.toLowerCase().includes(filter))&&(bank_list.append("<option value='"+an+" / "+no_rek+"'/>"),10==++counter))return!1}})),$("#bank").on("change",(function(){var bank=$(this).val().split("/");if($("#id_bank").val(""),2===bank.length)for(var an1=bank[0].trim().toLowerCase(),no_rek1=bank[1].trim().toLowerCase(),length=bank_arr.length,i=0;i<length;i++){var an=bank_arr[i].an,no_rek=bank_arr[i].no_rek;if(an.toLowerCase()===an1&&no_rek.toLowerCase()===no_rek1){var id_bank=bank_arr[i].id_bank;return $("#id_bank").val(id_bank),!1}}})),$("body").on("click","input[type='checkbox']",(function(){var biaowen=$(this).prev().val().split("|")[1];$(this).prop("checked")?$(this).prev().val("1|"+biaowen):$(this).prev().val("0|"+biaowen)})),$("#tambah_biaowen").on("click",(function(){tambah_biaowen()})),$("#nama_biaowen, #tambah_biaowen").on("keypress",(function(e){13===e.keyCode&&(e.preventDefault(),tambah_biaowen())})),$("table").on("click","a.hapus_biaowen",(function(){hapus_biaowen($(this))})),$("table").on("keypress","a.hapus_biaowen",(function(e){13===e.keyCode&&hapus_biaowen($(this))})),$("#reset_btn").on("click",(function(e){$("tbody").empty();for(var length=default_biaowen_list.length,i=0;i<length;i++){var biaowen_detail=default_biaowen_list[i].split("|"),checked=0==biaowen_detail[0]?"":"checked",tr_input="<tr>";tr_input+="<td>"+(i+1)+"</td>",tr_input+="<td class='centered'><input type='text' class='hidden' name='biaowen[]' value='"+default_biaowen_list[i]+"'/>",tr_input+="<input type='checkbox' "+checked+"/></td>",tr_input+="<td><div class='name_box2'><input type='text' readonly value='"+biaowen_detail[1]+"'></div></td>",tr_input+="<td class='centered'><a href='#' class='hapus_biaowen'>Hapus</a></td>",tr_input+="</tr>",$("tbody").append(tr_input)}}))}));